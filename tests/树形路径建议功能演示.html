<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>树形结构JSON路径建议功能演示</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        
        .demo-section {
            margin: 30px 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .demo-section h2 {
            color: #34495e;
            margin-top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .json-input {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            resize: vertical;
            background-color: #f8f9fa;
        }
        
        .json-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .depth-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .depth-control input {
            width: 60px;
            padding: 5px;
            border: 1px solid #bdc3c7;
            border-radius: 3px;
        }
        
        .tree-container {
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            padding: 15px;
            background-color: #fdfdfd;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tree-node {
            margin: 2px 0;
            user-select: none;
        }
        
        .tree-node-content {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tree-node-content:hover {
            background-color: #e8f4f8;
            transform: translateX(3px);
        }
        
        .tree-node-content.selected {
            background-color: #d5e8ff;
            border-left: 4px solid #3498db;
        }
        
        .tree-node-content.clickable {
            border-left: 3px solid transparent;
        }
        
        .tree-node-content.clickable:hover {
            border-left-color: #3498db;
        }
        
        .expand-icon {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
        
        .expand-icon.empty {
            visibility: hidden;
        }
        
        .node-label {
            font-weight: 500;
            color: #2c3e50;
            margin-right: 10px;
            font-size: 14px;
        }
        
        .node-path {
            font-family: 'Courier New', monospace;
            color: #8e44ad;
            font-size: 11px;
            background: #f4f1f8;
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 10px;
        }
        
        .node-description {
            color: #7f8c8d;
            font-size: 12px;
            flex: 1;
        }
        
        .node-type-badge {
            padding: 2px 6px;
            border-radius: 3px;
            color: white;
            font-size: 10px;
            margin-left: 8px;
        }
        
        .type-object { background: #9b59b6; }
        .type-array { background: #e67e22; }
        .type-primitive { background: #27ae60; }
        
        .tree-children {
            margin-left: 24px;
            border-left: 1px dashed #bdc3c7;
            position: relative;
        }
        
        .tree-children::before {
            content: '';
            position: absolute;
            left: -1px;
            top: 0;
            bottom: 20px;
            border-left: 1px dashed #bdc3c7;
        }
        
        .extracted-value {
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .info-box {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: #34495e;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
            min-width: 100px;
        }
        
        .stat-number {
            font-size: 20px;
            font-weight: bold;
            display: block;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preset-btn:hover {
            background: #7f8c8d;
        }
        
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .toolbar button {
            background: #34495e;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .toolbar button:hover {
            background: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌳 树形结构JSON路径建议功能演示</h1>
        
        <div class="info-box">
            <strong>树形结构特点：</strong>
            <ul>
                <li>🌲 <strong>层次化展示</strong>：真正的树形结构，清晰展现JSON的嵌套关系</li>
                <li>📁 <strong>可折叠节点</strong>：支持展开/折叠子节点，灵活控制显示内容</li>
                <li>🎯 <strong>智能分析</strong>：自动识别对象、数组、基本类型，提供专门的展示样式</li>
                <li>⚡ <strong>即时提取</strong>：点击任意节点即可实时提取对应路径的数据</li>
                <li>🔄 <strong>结构去重</strong>：数组中相同结构的元素自动合并展示</li>
                <li>📊 <strong>详细信息</strong>：每个节点显示类型、描述和路径信息</li>
            </ul>
        </div>
        
        <div class="demo-section">
            <h2>🧪 测试JSON数据</h2>
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadPreset('complex')">复杂嵌套对象</button>
                <button class="preset-btn" onclick="loadPreset('array')">嵌套数组结构</button>
                <button class="preset-btn" onclick="loadPreset('mixed')">混合结构数据</button>
                <button class="preset-btn" onclick="loadPreset('ecommerce')">电商数据示例</button>
            </div>
            
            <textarea id="jsonInput" class="json-input" placeholder="请输入JSON数据..."></textarea>
            
            <div class="controls">
                <button class="btn" onclick="analyzeJson()">🌳 分析树形结构</button>
                <div class="depth-control">
                    <label>分析深度：</label>
                    <input type="number" id="maxDepth" value="4" min="1" max="10">
                    <span>层</span>
                </div>
                <button class="btn" onclick="clearAll()">🗑️ 清空</button>
            </div>
            
            <div class="stats" id="stats" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>🌲 树形路径结构</h2>
            <div class="toolbar">
                <button onclick="expandAll()">🔄 全部展开</button>
                <button onclick="collapseAll()">📁 全部折叠</button>
                <button onclick="resetSelection()">🔄 重置选择</button>
            </div>
            <div id="treeContainer" class="tree-container">
                <p style="color: #7f8c8d; text-align: center; margin: 50px 0;">
                    请输入JSON数据并点击"分析树形结构"按钮
                </p>
            </div>
        </div>
        
        <div class="demo-section" id="extractionSection" style="display: none;">
            <h2>📤 提取结果</h2>
            <div>
                <strong>当前路径：</strong> <span id="currentPath" class="node-path"></span>
            </div>
            <div id="extractedValue"></div>
        </div>
    </div>

    <script type="module">
        // 导入JsonProcessor
        import { JsonProcessor } from '../src/utils/jsonProcessor.js'
        
        // 预设数据
        const presets = {
            complex: {
                "user": {
                    "id": 123,
                    "profile": {
                        "name": "张三",
                        "age": 30,
                        "contact": {
                            "email": "zhangsan@example.com",
                            "phone": {
                                "mobile": "13800138000",
                                "home": "010-12345678"
                            }
                        },
                        "preferences": {
                            "theme": "dark",
                            "language": "zh-CN",
                            "notifications": {
                                "email": true,
                                "sms": false,
                                "push": {
                                    "enabled": true,
                                    "frequency": "daily"
                                }
                            }
                        }
                    },
                    "orders": [
                        {
                            "id": "ORD001",
                            "items": [
                                {"name": "商品A", "price": 100, "quantity": 2},
                                {"name": "商品B", "price": 200, "quantity": 1}
                            ],
                            "shipping": {
                                "address": "北京市朝阳区xxx",
                                "method": "express"
                            }
                        }
                    ]
                },
                "settings": {
                    "app": {
                        "version": "2.1.0",
                        "features": ["feature1", "feature2", "feature3"]
                    }
                }
            },
            
            array: [
                {
                    "category": "电子产品",
                    "products": [
                        {
                            "name": "手机",
                            "models": [
                                {
                                    "brand": "苹果",
                                    "specifications": {
                                        "screen": "6.1英寸",
                                        "storage": ["128GB", "256GB", "512GB"],
                                        "features": {
                                            "camera": {"main": "12MP", "ultra_wide": "12MP"},
                                            "connectivity": ["5G", "WiFi6", "蓝牙5.0"]
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                }
            ],
            
            mixed: {
                "company": {
                    "name": "科技公司",
                    "departments": [
                        {
                            "name": "研发部",
                            "employees": [
                                {
                                    "id": 1001,
                                    "name": "李四",
                                    "skills": ["JavaScript", "Python", "Go"],
                                    "projects": [
                                        {
                                            "id": "P001",
                                            "name": "项目A",
                                            "status": "进行中",
                                            "timeline": {
                                                "start": "2024-01-01",
                                                "end": "2024-06-30",
                                                "milestones": [
                                                    {"date": "2024-03-01", "task": "需求分析完成"},
                                                    {"date": "2024-05-01", "task": "开发完成"}
                                                ]
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            },
            
            ecommerce: {
                "store": {
                    "id": "STORE001",
                    "name": "在线商城",
                    "products": [
                        {
                            "id": "PROD001",
                            "name": "智能手机",
                            "category": {
                                "main": "电子产品",
                                "sub": "通讯设备"
                            },
                            "variants": [
                                {
                                    "sku": "SKU001",
                                    "color": "黑色",
                                    "storage": "128GB",
                                    "price": {
                                        "original": 5999,
                                        "current": 5499,
                                        "currency": "CNY"
                                    },
                                    "inventory": {
                                        "stock": 100,
                                        "reserved": 5,
                                        "available": 95
                                    }
                                }
                            ],
                            "reviews": [
                                {
                                    "user": "用户A",
                                    "rating": 5,
                                    "comment": "很好用的手机",
                                    "date": "2024-01-15",
                                    "helpful": {
                                        "yes": 10,
                                        "no": 1
                                    }
                                }
                            ]
                        }
                    ]
                }
            }
        }
        
        let currentJsonData = null
        let currentTree = null
        let selectedNodeId = null
        
        // 全局函数定义
        window.loadPreset = function(type) {
            const data = presets[type]
            document.getElementById('jsonInput').value = JSON.stringify(data, null, 2)
        }
        
        window.analyzeJson = function() {
            const input = document.getElementById('jsonInput').value.trim()
            const maxDepth = parseInt(document.getElementById('maxDepth').value) || 4
            
            if (!input) {
                alert('请输入JSON数据')
                return
            }
            
            try {
                currentJsonData = input
                const parsed = JSON.parse(input)
                
                let tree
                if (Array.isArray(parsed)) {
                    tree = JsonProcessor.getArrayPathSuggestionsTree(input, maxDepth)
                } else {
                    tree = JsonProcessor.getObjectPathSuggestionsTree(input, maxDepth)
                }
                
                if (tree) {
                    currentTree = tree
                    renderTree(tree)
                    updateStats(tree, parsed)
                } else {
                    showError('无法分析JSON结构')
                }
                
            } catch (error) {
                showError('JSON格式错误: ' + error.message)
            }
        }
        
        window.clearAll = function() {
            document.getElementById('jsonInput').value = ''
            document.getElementById('treeContainer').innerHTML = '<p style="color: #7f8c8d; text-align: center; margin: 50px 0;">请输入JSON数据并点击"分析树形结构"按钮</p>'
            document.getElementById('stats').style.display = 'none'
            document.getElementById('extractionSection').style.display = 'none'
            currentTree = null
            selectedNodeId = null
        }
        
        window.expandAll = function() {
            if (currentTree) {
                expandNodeRecursive(currentTree)
                renderTree(currentTree)
            }
        }
        
        window.collapseAll = function() {
            if (currentTree) {
                collapseNodeRecursive(currentTree)
                currentTree.expanded = true // 保持根节点展开
                renderTree(currentTree)
            }
        }
        
        window.resetSelection = function() {
            selectedNodeId = null
            if (currentTree) {
                renderTree(currentTree)
            }
            document.getElementById('extractionSection').style.display = 'none'
        }
        
        function expandNodeRecursive(node) {
            node.expanded = true
            if (node.children) {
                node.children.forEach(child => expandNodeRecursive(child))
            }
        }
        
        function collapseNodeRecursive(node) {
            node.expanded = false
            if (node.children) {
                node.children.forEach(child => collapseNodeRecursive(child))
            }
        }
        
        function renderTree(tree) {
            const container = document.getElementById('treeContainer')
            container.innerHTML = renderNode(tree, 0)
        }
        
        function renderNode(node, level) {
            const hasChildren = node.children && node.children.length > 0
            const isSelected = selectedNodeId === node.id
            const canClick = node.path !== undefined && node.path !== ''
            
            let html = `
                <div class="tree-node">
                    <div class="tree-node-content ${canClick ? 'clickable' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="selectNode('${node.id}', '${node.path || ''}')">
                        <span class="expand-icon ${hasChildren ? (node.expanded ? 'expanded' : '') : 'empty'}" 
                              onclick="event.stopPropagation(); toggleNode('${node.id}')">
                            ${hasChildren ? '▶' : ''}
                        </span>
                        <span class="node-label">${node.label}</span>
                        <span class="node-path">${node.path || '(根)'}</span>
                        <span class="node-description">${node.description}</span>
                        <span class="node-type-badge type-${node.type}">${getTypeLabel(node.type)}</span>
                    </div>
            `
            
            if (hasChildren && node.expanded) {
                html += '<div class="tree-children">'
                node.children.forEach(child => {
                    html += renderNode(child, level + 1)
                })
                html += '</div>'
            }
            
            html += '</div>'
            return html
        }
        
        window.toggleNode = function(nodeId) {
            const node = findNodeById(currentTree, nodeId)
            if (node) {
                node.expanded = !node.expanded
                renderTree(currentTree)
            }
        }
        
        window.selectNode = function(nodeId, path) {
            selectedNodeId = nodeId
            renderTree(currentTree)
            
            if (path && path !== '(根)') {
                extractPath(path)
            } else if (path === '' || path === '(根)') {
                extractPath('$') // 对于根节点或空路径，提取整个对象
            }
        }
        
        function findNodeById(node, nodeId) {
            if (node.id === nodeId) {
                return node
            }
            
            if (node.children) {
                for (const child of node.children) {
                    const found = findNodeById(child, nodeId)
                    if (found) return found
                }
            }
            
            return null
        }
        
        function extractPath(path) {
            if (!currentJsonData) return
            
            try {
                let result
                if (!path || path === '$' || path === '(根)') {
                    result = JSON.parse(currentJsonData)
                } else {
                    result = JsonProcessor.extractJsonData(currentJsonData, path)
                }
                
                document.getElementById('currentPath').textContent = path || '$'
                document.getElementById('extractedValue').innerHTML = `<div class="extracted-value">${JSON.stringify(result, null, 2)}</div>`
                document.getElementById('extractionSection').style.display = 'block'
                
            } catch (error) {
                document.getElementById('extractedValue').innerHTML = `<div class="error">提取失败: ${error.message}</div>`
                document.getElementById('extractionSection').style.display = 'block'
            }
        }
        
        function updateStats(tree, data) {
            const stats = document.getElementById('stats')
            const nodeCount = countNodes(tree)
            const typeCount = countNodeTypes(tree)
            const maxDepth = getMaxDepth(tree)
            
            stats.innerHTML = `
                <div class="stat-item">
                    <span class="stat-number">${nodeCount}</span>
                    <span>节点总数</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${maxDepth}</span>
                    <span>最大深度</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${typeCount.object || 0}</span>
                    <span>对象节点</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${typeCount.array || 0}</span>
                    <span>数组节点</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${typeCount.primitive || 0}</span>
                    <span>基本节点</span>
                </div>
            `
            stats.style.display = 'flex'
        }
        
        function countNodes(node) {
            let count = 1
            if (node.children) {
                node.children.forEach(child => {
                    count += countNodes(child)
                })
            }
            return count
        }
        
        function countNodeTypes(node) {
            const counts = { object: 0, array: 0, primitive: 0 }
            
            function traverse(n) {
                counts[n.type] = (counts[n.type] || 0) + 1
                if (n.children) {
                    n.children.forEach(traverse)
                }
            }
            
            traverse(node)
            return counts
        }
        
        function getMaxDepth(node) {
            let maxDepth = node.depth
            if (node.children) {
                node.children.forEach(child => {
                    maxDepth = Math.max(maxDepth, getMaxDepth(child))
                })
            }
            return maxDepth
        }
        
        function getTypeLabel(type) {
            const labels = {
                'object': '对象',
                'array': '数组', 
                'primitive': '基本类型'
            }
            return labels[type] || type
        }
        
        function showError(message) {
            document.getElementById('treeContainer').innerHTML = `<div class="error">${message}</div>`
        }
        
        // 页面加载完成后加载默认数据
        window.addEventListener('load', () => {
            loadPreset('complex')
            analyzeJson()
        })
    </script>
</body>
</html>