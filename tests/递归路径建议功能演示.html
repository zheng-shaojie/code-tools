<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>递归JSON路径建议功能演示</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }
        
        .demo-section {
            margin: 30px 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .demo-section h2 {
            color: #34495e;
            margin-top: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .json-input {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            resize: vertical;
            background-color: #f8f9fa;
        }
        
        .json-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .controls {
            margin: 15px 0;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .depth-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .depth-control input {
            width: 60px;
            padding: 5px;
            border: 1px solid #bdc3c7;
            border-radius: 3px;
        }
        
        .suggestions-container {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            padding: 15px;
            background-color: #fdfdfd;
        }
        
        .suggestion-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            border-radius: 0 5px 5px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .suggestion-item:hover {
            background: #e8f4f8;
            border-left-color: #2980b9;
            transform: translateX(5px);
        }
        
        .suggestion-item.selected {
            background: #d5e8ff;
            border-left-color: #0066cc;
        }
        
        .suggestion-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .suggestion-path {
            font-family: 'Courier New', monospace;
            color: #8e44ad;
            font-size: 12px;
            background: #f4f1f8;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
            margin: 2px 0;
        }
        
        .suggestion-description {
            color: #7f8c8d;
            font-size: 13px;
            margin-top: 5px;
        }
        
        .suggestion-meta {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            font-size: 11px;
        }
        
        .depth-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .type-badge {
            padding: 2px 6px;
            border-radius: 3px;
            color: white;
        }
        
        .type-object { background: #9b59b6; }
        .type-array { background: #e67e22; }
        .type-primitive { background: #27ae60; }
        
        .extracted-value {
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .info-box {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: #34495e;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            text-align: center;
            min-width: 100px;
        }
        
        .stat-number {
            font-size: 20px;
            font-weight: bold;
            display: block;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .preset-btn:hover {
            background: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 递归JSON路径建议功能演示</h1>
        
        <div class="info-box">
            <strong>功能特点：</strong>
            <ul>
                <li>🎯 <strong>深度递归分析</strong>：支持分析多层嵌套的JSON结构</li>
                <li>🏷️ <strong>类型可视化</strong>：使用图标和颜色区分不同数据类型（📦对象、🔢数组、📄基本类型）</li>
                <li>📊 <strong>结构化展示</strong>：按深度层级缩进显示，清晰展现JSON层次结构</li>
                <li>🎛️ <strong>深度控制</strong>：可自定义分析深度，平衡性能和完整性</li>
                <li>✨ <strong>智能去重</strong>：自动识别数组中相同结构的元素，避免重复建议</li>
                <li>⚡ <strong>实时提取</strong>：点击建议即可实时提取对应路径的数据</li>
            </ul>
        </div>
        
        <div class="demo-section">
            <h2>🧪 测试JSON数据</h2>
            <div class="preset-buttons">
                <button class="preset-btn" onclick="loadPreset('complex')">复杂嵌套对象</button>
                <button class="preset-btn" onclick="loadPreset('array')">嵌套数组结构</button>
                <button class="preset-btn" onclick="loadPreset('mixed')">混合结构数据</button>
                <button class="preset-btn" onclick="loadPreset('ecommerce')">电商数据示例</button>
            </div>
            
            <textarea id="jsonInput" class="json-input" placeholder="请输入JSON数据..."></textarea>
            
            <div class="controls">
                <button class="btn" onclick="analyzeJson()">🔍 分析路径建议</button>
                <div class="depth-control">
                    <label>分析深度：</label>
                    <input type="number" id="maxDepth" value="4" min="1" max="10">
                    <span>层</span>
                </div>
                <button class="btn" onclick="clearAll()">🗑️ 清空</button>
            </div>
            
            <div class="stats" id="stats" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>💡 路径建议结果</h2>
            <div id="suggestionsContainer" class="suggestions-container">
                <p style="color: #7f8c8d; text-align: center; margin: 50px 0;">
                    请输入JSON数据并点击"分析路径建议"按钮
                </p>
            </div>
        </div>
        
        <div class="demo-section" id="extractionSection" style="display: none;">
            <h2>📤 提取结果</h2>
            <div>
                <strong>当前路径：</strong> <span id="currentPath" class="suggestion-path"></span>
            </div>
            <div id="extractedValue"></div>
        </div>
    </div>

    <script type="module">
        // 导入JsonProcessor（需要确保路径正确）
        import { JsonProcessor } from '../src/utils/jsonProcessor.js'
        
        // 预设数据
        const presets = {
            complex: {
                "user": {
                    "id": 123,
                    "profile": {
                        "name": "张三",
                        "age": 30,
                        "contact": {
                            "email": "zhangsan@example.com",
                            "phone": {
                                "mobile": "13800138000",
                                "home": "010-12345678"
                            }
                        },
                        "preferences": {
                            "theme": "dark",
                            "language": "zh-CN",
                            "notifications": {
                                "email": true,
                                "sms": false,
                                "push": {
                                    "enabled": true,
                                    "frequency": "daily"
                                }
                            }
                        }
                    },
                    "orders": [
                        {
                            "id": "ORD001",
                            "items": [
                                {"name": "商品A", "price": 100, "quantity": 2},
                                {"name": "商品B", "price": 200, "quantity": 1}
                            ],
                            "shipping": {
                                "address": "北京市朝阳区xxx",
                                "method": "express"
                            }
                        }
                    ]
                },
                "settings": {
                    "app": {
                        "version": "2.1.0",
                        "features": ["feature1", "feature2", "feature3"]
                    }
                }
            },
            
            array: [
                {
                    "category": "电子产品",
                    "products": [
                        {
                            "name": "手机",
                            "models": [
                                {
                                    "brand": "苹果",
                                    "specifications": {
                                        "screen": "6.1英寸",
                                        "storage": ["128GB", "256GB", "512GB"],
                                        "features": {
                                            "camera": {"main": "12MP", "ultra_wide": "12MP"},
                                            "connectivity": ["5G", "WiFi6", "蓝牙5.0"]
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                }
            ],
            
            mixed: {
                "company": {
                    "name": "科技公司",
                    "departments": [
                        {
                            "name": "研发部",
                            "employees": [
                                {
                                    "id": 1001,
                                    "name": "李四",
                                    "skills": ["JavaScript", "Python", "Go"],
                                    "projects": [
                                        {
                                            "id": "P001",
                                            "name": "项目A",
                                            "status": "进行中",
                                            "timeline": {
                                                "start": "2024-01-01",
                                                "end": "2024-06-30",
                                                "milestones": [
                                                    {"date": "2024-03-01", "task": "需求分析完成"},
                                                    {"date": "2024-05-01", "task": "开发完成"}
                                                ]
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            },
            
            ecommerce: {
                "store": {
                    "id": "STORE001",
                    "name": "在线商城",
                    "products": [
                        {
                            "id": "PROD001",
                            "name": "智能手机",
                            "category": {
                                "main": "电子产品",
                                "sub": "通讯设备"
                            },
                            "variants": [
                                {
                                    "sku": "SKU001",
                                    "color": "黑色",
                                    "storage": "128GB",
                                    "price": {
                                        "original": 5999,
                                        "current": 5499,
                                        "currency": "CNY"
                                    },
                                    "inventory": {
                                        "stock": 100,
                                        "reserved": 5,
                                        "available": 95
                                    }
                                }
                            ],
                            "reviews": [
                                {
                                    "user": "用户A",
                                    "rating": 5,
                                    "comment": "很好用的手机",
                                    "date": "2024-01-15",
                                    "helpful": {
                                        "yes": 10,
                                        "no": 1
                                    }
                                }
                            ]
                        }
                    ]
                }
            }
        }
        
        let currentJsonData = null
        let currentSuggestions = []
        
        // 全局函数定义
        window.loadPreset = function(type) {
            const data = presets[type]
            document.getElementById('jsonInput').value = JSON.stringify(data, null, 2)
        }
        
        window.analyzeJson = function() {
            const input = document.getElementById('jsonInput').value.trim()
            const maxDepth = parseInt(document.getElementById('maxDepth').value) || 4
            
            if (!input) {
                alert('请输入JSON数据')
                return
            }
            
            try {
                currentJsonData = input
                const parsed = JSON.parse(input)
                
                let suggestions
                if (Array.isArray(parsed)) {
                    suggestions = JsonProcessor.getArrayPathSuggestions(input, maxDepth)
                } else {
                    suggestions = JsonProcessor.getObjectPathSuggestions(input, maxDepth)
                }
                
                currentSuggestions = suggestions
                renderSuggestions(suggestions)
                updateStats(suggestions, parsed)
                
            } catch (error) {
                showError('JSON格式错误: ' + error.message)
            }
        }
        
        window.clearAll = function() {
            document.getElementById('jsonInput').value = ''
            document.getElementById('suggestionsContainer').innerHTML = '<p style="color: #7f8c8d; text-align: center; margin: 50px 0;">请输入JSON数据并点击"分析路径建议"按钮</p>'
            document.getElementById('stats').style.display = 'none'
            document.getElementById('extractionSection').style.display = 'none'
        }
        
        function renderSuggestions(suggestions) {
            const container = document.getElementById('suggestionsContainer')
            
            if (suggestions.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d; text-align: center; margin: 50px 0;">没有找到可用的路径建议</p>'
                return
            }
            
            container.innerHTML = suggestions.map((suggestion, index) => `
                <div class="suggestion-item" onclick="selectSuggestion(${index})">
                    <div class="suggestion-label">${suggestion.label}</div>
                    <div class="suggestion-path">${suggestion.path || '(根路径)'}</div>
                    <div class="suggestion-description">${suggestion.description}</div>
                    <div class="suggestion-meta">
                        <span class="depth-badge">深度 ${suggestion.depth}</span>
                        <span class="type-badge type-${suggestion.type}">${getTypeLabel(suggestion.type)}</span>
                    </div>
                </div>
            `).join('')
        }
        
        window.selectSuggestion = function(index) {
            // 清除之前的选中状态
            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.classList.remove('selected')
            })
            
            // 标记当前选中
            document.querySelectorAll('.suggestion-item')[index].classList.add('selected')
            
            const suggestion = currentSuggestions[index]
            extractPath(suggestion.path)
        }
        
        function extractPath(path) {
            if (!currentJsonData) return
            
            try {
                let result
                if (!path || path === '$') {
                    result = JSON.parse(currentJsonData)
                } else {
                    result = JsonProcessor.extractJsonData(currentJsonData, path)
                }
                
                document.getElementById('currentPath').textContent = path || '$'
                document.getElementById('extractedValue').innerHTML = `<div class="extracted-value">${JSON.stringify(result, null, 2)}</div>`
                document.getElementById('extractionSection').style.display = 'block'
                
            } catch (error) {
                document.getElementById('extractedValue').innerHTML = `<div class="error">提取失败: ${error.message}</div>`
                document.getElementById('extractionSection').style.display = 'block'
            }
        }
        
        function updateStats(suggestions, data) {
            const stats = document.getElementById('stats')
            const typeCount = suggestions.reduce((acc, s) => {
                acc[s.type] = (acc[s.type] || 0) + 1
                return acc
            }, {})
            
            const maxDepth = Math.max(...suggestions.map(s => s.depth))
            
            stats.innerHTML = `
                <div class="stat-item">
                    <span class="stat-number">${suggestions.length}</span>
                    <span>总建议数</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${maxDepth}</span>
                    <span>最大深度</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${typeCount.object || 0}</span>
                    <span>对象字段</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${typeCount.array || 0}</span>
                    <span>数组字段</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${typeCount.primitive || 0}</span>
                    <span>基本字段</span>
                </div>
            `
            stats.style.display = 'flex'
        }
        
        function getTypeLabel(type) {
            const labels = {
                'object': '对象',
                'array': '数组', 
                'primitive': '基本类型'
            }
            return labels[type] || type
        }
        
        function showError(message) {
            document.getElementById('suggestionsContainer').innerHTML = `<div class="error">${message}</div>`
        }
        
        // 页面加载完成后加载默认数据
        window.addEventListener('load', () => {
            loadPreset('complex')
            analyzeJson()
        })
    </script>
</body>
</html>